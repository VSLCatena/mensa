<div class="container">
  <div class="row">
    <div class="col">
      <div class="card">
        <div class="card-header">
          <ng-container *ngIf="!page || page === 0; else dateRange">
            Mensae in de komende 2 weken
          </ng-container>
          <ng-template #dateRange>
            Mensae tussen {{ getDateForPage((page * 2) - 1, dayOfWeek.Monday) | date:'EEEE d MMM' }} en {{ getDateForPage((page * 2) + 1, dayOfWeek.Sunday) | date:'EEEE d MMM'}}
          </ng-template>
        </div>

        <div class="card-body">
          <table class="table responsive-table mensae">
            <thead>
                <tr>
                    <th>Datum</th>
                    <th>Beschrijving</th>
                    <th>Prijs</th>
                    <th>Inschrijvingen</th>
                    <th>Sluittijd</th>
                    <th>Inschrijven</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngIf="mensaeDtoList[page.toString()].length > 0">
                    <ng-container *ngFor="let mensaDto of mensaeDtoList[page.toString()]">
                        <tr [class.cancelled]="mensaDto.mensa.maxUsers <= 0 && mensaDto.enrollments <= 0">
                        <td>{{mensaDto.mensa.date | date:'EEEE d MMM HH:mm'}}</td>
                        <td>
                            {{mensaDto.mensa.title}}
                            <ng-container *ngIf="mensaDto.menuItems.length > 0">
                                <app-menu-collapse class="ms-1" [menuItems]="getMenuItems(mensaDto.menuItems)"></app-menu-collapse>
                            </ng-container>
                            <ng-container *ngFor="let option of mensaDto.extraOptions">
                                <div>
                                    <strong><u>Extra optie:</u></strong>
                                    {{option.description}} voor &euro;{{ option.price }}
                                </div>
                            </ng-container>
                            <div>Gekookt door: {{mensaDto.cooks.join(' en ')}}</div>
                        </td>
                        <td>&euro;{{mensaDto.mensa.price}}</td>
                        <td>
                            {{mensaDto.enrollments}} / {{mensaDto.mensa.maxUsers}}<br>
                            <ng-container *ngIf="mensaDto.dishwashers.length > 0">
                                {{mensaDto.dishwashers.length}} afwasser<span *ngIf="mensaDto.dishwashers.length > 1">s</span>
                            </ng-container>
                        </td>
                        <td>
                            <ng-container *ngIf="mensaDto.mensa.maxUsers <= 0; else closingTimeBlock">
                                <span class="text-danger">Geannuleerd</span>
                            </ng-container>
                            <ng-template #closingTimeBlock>
                                <ng-container *ngIf="mensaDto.mensa.closed; else notClosedBlock">
                                    <span class="text-danger">Gesloten</span>
                                </ng-container>
                                <ng-template #notClosedBlock>
                                    {{mensaDto.mensa.closingTime | date:'EEEE d MMM HH:mm'}}
                                </ng-template>
                            </ng-template>
                        </td>
                        <td>
                            <div class="btn-group-vertical">
                                <app-mensa-button [mensa]="mensaDto.mensa" [enrollments]="mensaDto.enrollments"></app-mensa-button>
                                <a *ngIf="isServiceUser()" [routerLink]="['/mensa-details', mensaDto.mensa.id, '']" class="btn btn-info admin-button">Bekijken</a>
                            </div>
                        </td>
                        </tr>
                    </ng-container>
                </ng-container>

                <ng-container *ngIf="mensaeDtoList[page.toString()].length <= 0 && !isLoading">
                    <tr>
                        <td colspan="6">Er zijn geen mensae gevonden!</td>
                    </tr>
                </ng-container>

            </tbody>
          </table>
            <div *ngIf="isLoading" class="d-flex justify-content-center">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>

        <div class="card-footer">
            <button (click)="getPage(tableNavigate.Previous)" class="btn btn-outline-secondary float-start">Terug</button>
            <button (click)="getPage(tableNavigate.Next)" class="btn btn-outline-secondary float-end">Volgende</button>
          <div class="clearfix"></div>
        </div>
      </div>
    </div>
  </div>
</div>
